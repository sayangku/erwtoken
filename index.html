<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoReward Orman Oyunu</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Önceki CSS stilleri burada */
    </style>
</head>
<body>
    <h1>🌍 EcoReward Orman Oyunu 🌍</h1>
    <div id="status"></div>
    <div id="game-board"></div>

    <script>
        const treeEmojis = ['🌳', '🌴', '🌲', '🌿', '🍃'];
        const rareTrees = ['🍎', '🍐', '🍊', '🥥', '🌺'];
        let gameBoard = [];
        let points = 0;
        let erwTokens = 0;
        let level = 1;
        let forestSize = 0;

        // Oyun verilerini yükle
        function loadGameData() {
            const initData = window.Telegram.WebApp.initData;
            if (initData) {
                const data = JSON.parse(initData);
                points = data.points || 0;
                erwTokens = data.erw_tokens || 0;
                level = data.level || 1;
                forestSize = data.forest ? data.forest.length : 0;
                gameBoard = data.forest || createNewBoard();
            } else {
                gameBoard = createNewBoard();
            }
            renderBoard();
            updateStatus();
        }

        function createNewBoard() {
            return Array(9).fill().map(() => {
                return Math.random() < 0.1 ? rareTrees[Math.floor(Math.random() * rareTrees.length)] : treeEmojis[Math.floor(Math.random() * treeEmojis.length)];
            });
        }

        function renderBoard() {
            const boardElement = document.getElementById('game-board');
            boardElement.innerHTML = '';
            gameBoard.forEach((tree, index) => {
                const button = document.createElement('button');
                button.className = 'tree-button';
                button.textContent = tree;
                button.onclick = () => tapTree(index);
                boardElement.appendChild(button);
            });
        }

        function tapTree(index) {
            const tappedTree = gameBoard[index];
            let earnedPoints = rareTrees.includes(tappedTree) ? Math.floor(Math.random() * 11) + 10 : Math.floor(Math.random() * 5) + 1;
            points += earnedPoints;
            forestSize++;
            gameBoard[index] = treeEmojis[Math.floor(Math.random() * treeEmojis.length)];
            renderBoard();
            updateStatus(`+${earnedPoints} puan kazandın!`);
            checkLevelUp();
        }

        function checkLevelUp() {
            const newTokens = Math.floor(points / 100);
            if (newTokens > 0) {
                erwTokens += newTokens;
                points %= 100;
                const newLevel = Math.floor(erwTokens / 10) + 1;
                if (newLevel > level) {
                    level = newLevel;
                    updateStatus(`Tebrikler! Yeni seviye: ${level}`);
                }
            }
        }

        function updateStatus(message = '') {
            const statusElement = document.getElementById('status');
            statusElement.innerHTML = `
                Seviye: ${level} 🏆<br>
                Puanınız: ${points}<br>
                ERW Token: ${erwTokens}<br>
                Orman Büyüklüğü: ${forestSize} 🌳<br>
                ${message}
            `;
        }

        // Oyun verilerini kaydet
        function saveGameData() {
            window.Telegram.WebApp.sendData(JSON.stringify({
                points: points,
                erwTokens: erwTokens,
                level: level,
                forest: gameBoard
            }));
        }

        // Oyunu başlat
        loadGameData();

        // Telegram WebApp entegrasyonu
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.MainButton.setText('Oyunu Bitir').show().onClick(saveGameData);
    </script>
</body>
</html>
