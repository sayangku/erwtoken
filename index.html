<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoReward Orman Oyunu</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Existing styles... */
    </style>
</head>
<body>
    <h1>🌍 EcoReward Orman Oyunu 🌍</h1>
    <div id="status"></div>
    <div id="game-board"></div>
    <button id="endGameButton" style="display:none;">Oyunu Bitir</button>

    <script>
        const treeEmojis = ['🌳', '🌴', '🌲', '🌿', '🍃'];
        const rareTrees = ['🍎', '🍐', '🍊', '🥥', '🌺'];
        let gameBoard = [];
        let points = 0;
        let erwTokens = 0;
        let level = 1;
        let forestSize = 0;

        // URL'den gelen parametreleri alıyoruz
        const urlParams = new URLSearchParams(window.location.search);
        points = parseInt(urlParams.get('points')) || 0;
        erwTokens = parseInt(urlParams.get('erwTokens')) || 0;
        level = parseInt(urlParams.get('level')) || 1;
        forestSize = parseInt(urlParams.get('forestSize')) || 0;

        // Existing functions: createBoard, renderBoard, tapTree, checkLevelUp, updateStatus

        function endGame() {
            console.log("Oyunu Bitir butonu tıklandı");
            const gameData = {
                points: points,
                erwTokens: erwTokens,
                level: level,
                forestSize: forestSize
            };
            console.log("Gönderilecek veri:", gameData);
            
            try {
                window.Telegram.WebApp.sendData(JSON.stringify(gameData));
                console.log("Veri başarıyla gönderildi");
            } catch (error) {
                console.error("Veri gönderirken hata oluştu:", error);
                alert("Oyun verisi gönderilirken bir hata oluştu. Lütfen tekrar deneyin.");
            }
        }

        createBoard();
        updateStatus();

        // Telegram WebApp entegrasyonu
        window.Telegram.WebApp.ready();
        
        const endGameButton = document.getElementById('endGameButton');
        
        if (window.Telegram.WebApp.platform === "android" || window.Telegram.WebApp.platform === "ios") {
            // Mobil cihazlar için özel buton
            endGameButton.style.display = 'block';
            endGameButton.addEventListener('click', endGame);
        } else {
            // Masaüstü için MainButton
            window.Telegram.WebApp.MainButton.setText('Oyunu Bitir').show().onClick(endGame);
        }

        // Debug bilgisi
        console.log("Telegram WebApp Platform:", window.Telegram.WebApp.platform);
        console.log("Telegram WebApp Version:", window.Telegram.WebApp.version);
    </script>
</body>
</html>
